<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Craven Laura - Incoming Calls</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #2a3a55;
    color: white;
    margin: 0; padding: 20px;
    min-height: 100vh;
  }
  h1 {
    text-align: center;
    margin-bottom: 30px;
  }
  #callsList {
    max-width: 600px;
    margin: 0 auto;
  }
  .callItem {
    background: #374a75;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 15px;
    cursor: pointer;
    transition: background 0.3s;
  }
  .callItem:hover {
    background: #4a5e9a;
  }
  .callName {
    font-weight: bold;
    font-size: 1.1em;
  }
  .callRequest {
    margin: 5px 0;
    font-style: italic;
    color: #cfd6ff;
  }
  .status {
    font-size: 0.9em;
    padding: 3px 8px;
    border-radius: 12px;
    display: inline-block;
  }
  .waiting {
    background: #f39c12;
    color: black;
  }
  .connected {
    background: #27ae60;
  }
  .ended {
    background: #c0392b;
  }
</style>
</head>
<body>
  <h1>Craven Laura - Incoming Calls</h1>
  <div id="callsList">Loading calls...</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
  import { getFirestore, collection, onSnapshot } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDzWe0sMFecKa9sHk30pXat5qrT4yDyuJ4",
    authDomain: "soccer2-c47c2.firebaseapp.com",
    databaseURL: "https://soccer2-c47c2-default-rtdb.firebaseio.com",
    projectId: "soccer2-c47c2",
    storageBucket: "soccer2-c47c2.appspot.com",
    messagingSenderId: "942310698005",
    appId: "1:942310698005:web:2f5230da671ef0b47db21c"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const callsCollection = collection(db, "calls");
  const callsList = document.getElementById('callsList');

  function renderCallItem(callId, callData) {
    const div = document.createElement('div');
    div.className = 'callItem';

    const name = document.createElement('div');
    name.className = 'callName';
    name.textContent = callData.name || 'Unknown Caller';

    const request = document.createElement('div');
    request.className = 'callRequest';
    request.textContent = callData.request || 'No request provided';

    const status = document.createElement('span');
    status.className = 'status';
    if (!callData.answer) {
      status.textContent = 'Waiting';
      status.classList.add('waiting');
    } else if (callData.ended) {
      status.textContent = 'Ended';
      status.classList.add('ended');
    } else {
      status.textContent = 'Connected';
      status.classList.add('connected');
    }

    div.appendChild(name);
    div.appendChild(request);
    div.appendChild(status);

    div.onclick = () => {
      if (!callData.ended) {
        window.open(`video-room.html?callId=${callId}`, '_blank');
      } else {
        alert('This call has ended.');
      }
    };

    return div;
  }

  function updateCallsList(snapshot) {
    callsList.innerHTML = '';
    if (snapshot.empty) {
      callsList.textContent = 'No current calls.';
      return;
    }
    snapshot.forEach(docSnap => {
      const callId = docSnap.id;
      const callData = docSnap.data();
      const callItem = renderCallItem(callId, callData);
      callsList.appendChild(callItem);
    });
  }

  onSnapshot(callsCollection, snapshot => {
    updateCallsList(snapshot);
  });

</script>
</body>
</html>
